<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Security Audit Report</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

        /* Reset v√† c∆° b·∫£n */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Roboto', sans-serif; 
            font-size: 13px;
            color: #333; 
            background-color: #f8f9fa; 
            margin: 0; 
            padding: 15px;
            line-height: 1.5;
        }
        @page { size: A4; margin: 0; }
        .container { 
            background: white; 
            width: 210mm; 
            min-height: 297mm; 
            margin: 0 auto; 
            padding: 20px 25px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        /* --- HEADER ƒê∆†N GI·∫¢N --- */
        .report-header {
            background: #0c2461;
            color: white;
            padding: 30px 35px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(12, 36, 97, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            page-break-inside: avoid;
        }
        
        .header-left { 
            flex: 1;
        }
        .header-left h1 { 
            font-size: 32px;
            font-weight: 900; 
            line-height: 1.1; 
            margin: 0 0 8px 0; 
            letter-spacing: 0.5px; 
        }
        .header-left .subtitle { 
            font-size: 18px;
            color: #a5b1e8; 
            font-weight: 400; 
            letter-spacing: 0.5px; 
            display: block;
        }
        
        .header-right { 
            background: rgba(255, 255, 255, 0.08); 
            padding: 18px 22px;
            border-radius: 6px; 
            border: 1px solid rgba(255, 255, 255, 0.15); 
            min-width: 240px;
            margin-left: 30px;
        }
        
        .meta-row { 
            margin-bottom: 8px;
            color: #ecf0f1; 
            font-size: 13px;
            display: flex;
            justify-content: space-between;
        }
        .meta-label {
            color: #a5b1e8;
            font-weight: 500;
            margin-right: 12px;
        }
        .meta-value { 
            color: #fff; 
            font-weight: 700; 
            text-align: right;
            font-size: 14px;
        }

        /* --- SCORECARD --- */
        .score-card {
            background-color: #fff; 
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px; 
            border: 1px solid #e0e0e0; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: block; 
            overflow: hidden;
            page-break-inside: avoid;
        }
        .score-left { float: left; width: 55%; }
        .score-right { float: right; width: 40%; text-align: right; }
        .score-title { 
            font-size: 13px;
            text-transform: uppercase; 
            font-weight: 700; 
            color: #666; 
            margin-bottom: 10px; 
            display: block; 
            letter-spacing: 0.8px;
        }
        .score-big { 
            font-size: 48px;
            font-weight: 900; 
            color: #2c3e50; 
            line-height: 1; 
            display: inline-block;
            margin-right: 10px;
        }
        .score-sub { 
            font-size: 16px;
            color: #7f8c8d; 
            vertical-align: bottom;
        }
        .progress-container { 
            background-color: #ecf0f1; 
            height: 14px;
            border-radius: 7px; 
            overflow: hidden; 
            margin-top: 15px; 
            width: 90%; 
            clear: both; 
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); 
        }
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, #2ecc71, #27ae60); 
            display: block; 
        }
        
        .score-stats { margin-top: 12px; }
        .stat-item { 
            display: inline-block; 
            margin-left: 20px;
            text-align: center; 
            padding: 0 10px;
        }
        .stat-item strong { 
            display: block; 
            font-size: 24px;
            color: #2c3e50; 
            line-height: 1.2; 
        }
        .stat-item span { 
            font-size: 11px;
            text-transform: uppercase; 
            color: #7f8c8d; 
            font-weight: 700; 
            letter-spacing: 0.8px;
        }
        .text-pass { color: #27ae60 !important; }
        .text-fail { color: #c0392b !important; }
        .text-manual { color: #f39c12 !important; }

        /* --- Manual Review Notice --- */
        .manual-note {
            background-color: #fffde7;
            border-left: 5px solid #ffd600;
            padding: 18px;
            margin: 15px 0 25px 0;
            border-radius: 0 6px 6px 0;
            font-size: 12px;
            page-break-inside: avoid;
        }
        .manual-note h3 { 
            margin: 0 0 10px 0; 
            color: #f39c12; 
            font-size: 14px;
            font-weight: 700;
        }
        .manual-note p { margin: 0; }

        /* --- DASHBOARD --- */
        .section-title { 
            font-size: 18px;
            font-weight: 800; 
            color: #2c3e50; 
            margin: 30px 0 20px 0;
            clear: both; 
            padding-top: 10px; 
            text-transform: uppercase; 
            border-bottom: 2px solid #e0e0e0; 
            padding-bottom: 10px; 
            page-break-before: always;
        }
        .section-title:first-of-type { page-break-before: avoid; }
        
        .dashboard { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 25px; 
            flex-wrap: wrap;
            page-break-inside: avoid;
        }
        .stat-card { 
            width: 23%; 
            min-width: 120px;
            background: #fff; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px; 
            padding: 18px;
            text-align: center; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.07); 
            border-top: 5px solid #ccc;
            margin-bottom: 10px;
        }
        
        .card-critical { border-top-color: #c0392b; }
        .card-high { border-top-color: #d35400; }
        .card-medium { border-top-color: #f39c12; }
        .card-low { border-top-color: #3498db; }
        .stat-number { 
            font-size: 32px;
            font-weight: 900; 
            display: block; 
            margin-bottom: 5px; 
            line-height: 1; 
        }
        .stat-label { 
            font-size: 11px;
            text-transform: uppercase; 
            font-weight: 700; 
            color: #7f8c8d; 
            letter-spacing: 0.8px;
        }
        .text-critical { color: #c0392b; }
        .text-high { color: #d35400; }
        .text-medium { color: #f39c12; }
        .text-low { color: #3498db; }

        /* --- FINDINGS --- */
        .finding-card { 
            border: 1px solid #ddd; 
            border-radius: 8px;
            margin-bottom: 20px; 
            background: white; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
            overflow: hidden; 
            page-break-inside: avoid;
        }

        .finding-header { 
            background-color: #34495e;
            color: white;
            padding: 15px 20px;
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .finding-title { 
            font-size: 14px;
            font-weight: 700; 
            flex: 1;
            padding-right: 15px;
        }

        .badge { 
            padding: 4px 8px;
            border-radius: 4px; 
            font-weight: 700; 
            font-size: 11px;
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        .badge-fail { background: #c0392b; color: white; }
        .badge-pass { background: #27ae60; color: white; }
        .badge-manual { background: #f39c12; color: white; }
        .badge-skip { background: #7f8c8d; color: white; }
        .badge-error { background: #95a5a6; color: white; }
        .badge-severity { 
            margin-left: 10px;
            background: rgba(255,255,255,0.2); 
            color: white; 
            border: 1px solid rgba(255,255,255,0.3); 
        }

        .finding-body { padding: 20px; }
        .sub-label { 
            display: inline-block; 
            background-color: #f1f8ff; 
            color: #0d47a1; 
            font-size: 11px;
            font-weight: 700; 
            text-transform: uppercase; 
            padding: 4px 10px;
            border-radius: 4px; 
            margin: 18px 0 8px 0;
            letter-spacing: 0.5px;
        }
        .sub-label:first-child { margin-top: 0; }
        .content-text { 
            font-size: 13px;
            color: #444; 
            margin-bottom: 10px;
            line-height: 1.6;
        }
        .content-text ul, .content-text ol {
            margin-left: 24px;
            margin-bottom: 10px;
        }
        
        .remediation-box { 
            background-color: #e8f4fd; 
            border-left: 5px solid #3498db;
            padding: 15px;
            font-family: 'JetBrains Mono', monospace; 
            color: #0d47a1; 
            font-size: 12px;
            border-radius: 0 4px 4px 0; 
            margin: 10px 0;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
            page-break-inside: avoid;
        }
        
        /* Evidence box */
        .evidence-box { 
            background-color: #f8f9fa; 
            color: #2d3436; 
            padding: 15px;
            font-family: 'JetBrains Mono', monospace; 
            font-size: 12px;
            border-radius: 6px;
            white-space: pre-wrap; 
            word-wrap: break-word; 
            border: 1px solid #e0e0e0; 
            border-left: 5px solid #636e72;
            margin: 10px 0;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            page-break-inside: avoid;
        }

        /* Footer */
        .footer { 
            margin-top: 40px;
            border-top: 1px solid #eee; 
            padding-top: 18px;
            text-align: center; 
            font-size: 11px;
            color: #95a5a6; 
            clear: both;
            page-break-inside: avoid;
        }

        /* Responsive adjustments for print */
        @media print {
            body { 
                background: white; 
                padding: 0; 
                margin: 0; 
            }
            .container { 
                box-shadow: none; 
                padding: 15px 20px; 
                width: 100%; 
                height: auto; 
                min-height: 0;
            }
            .finding-card { 
                box-shadow: none; 
                border: 1px solid #ddd;
                margin-bottom: 15px;
            }
            .section-title { 
                page-break-before: auto;
                margin-top: 20px;
            }
            .manual-note, .score-card, .report-header {
                page-break-inside: avoid;
            }
        }

        /* Utility classes */
        .page-break { page-break-before: always; }
        .keep-together { page-break-inside: avoid; }
        .small-text { font-size: 11px; }
        .monospace { font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="report-header keep-together">
            <div class="header-left">
                <h1>CIS APACHE AUDIT REPORT</h1>
                <div class="subtitle">APACHE 2.4 SECURITY CONFIGURATION CHECK</div>
            </div>
            <div class="header-right">
                <div class="meta-row">
                    <span class="meta-label">Hostname:</span>
                    <span class="meta-value">{{ hostname }}</span>
                </div>
                <div class="meta-row">
                    <span class="meta-label">IP Address:</span>
                    <span class="meta-value">{{ ip_address }}</span>
                </div>
                <div class="meta-row">
                    <span class="meta-label">Scan Date:</span>
                    <span class="meta-value">{{ date }}</span>
                </div>
            </div>
        </div>

        <div class="section-title">COMPLIANCE OVERVIEW</div>
        <div class="score-card keep-together">
            <div class="score-left">
                <span class="score-title">OVERALL COMPLIANCE SCORE</span>
                <div>
                    <span class="score-big">{{ score }}%</span>
                    <span class="score-sub">Security Baseline</span>
                </div>
                <div class="progress-container">
                    <div class="progress-fill" style="width: {{ score }}%;"></div>
                </div>
            </div>
            <div class="score-right">
                <div class="score-stats">
                    <div class="stat-item">
                        <strong>{{ total_checks }}</strong><span>TOTAL</span>
                    </div>
                    <div class="stat-item">
                        <strong class="text-pass">{{ passed_checks }}</strong><span>PASSED</span>
                    </div>
                    <div class="stat-item">
                        <strong class="text-fail">{{ failed_checks }}</strong><span>FAILED</span>
                    </div>
                    <div class="stat-item">
                        <strong class="text-manual">{{ manual_checks }}</strong><span>MANUAL</span>
                    </div>
                </div>
            </div>
        </div>

        {% if manual_checks > 0 %}
        <div class="manual-note keep-together">
            <h3>‚ö† MANUAL REVIEW REQUIRED</h3>
            <p>{{ manual_checks }} checks require manual review. These items cannot be automatically verified and should be checked by a system administrator according to CIS Benchmark guidelines.</p>
        </div>
        {% endif %}

        <div class="section-title">RISK ANALYSIS (FAILED ITEMS)</div>
        <div class="dashboard keep-together">
            <div class="stat-card card-critical">
                <span class="stat-number text-critical">{{ count_critical }}</span>
                <span class="stat-label">Critical</span>
            </div>
            <div class="stat-card card-high">
                <span class="stat-number text-high">{{ count_high }}</span>
                    <span class="stat-label">High Risk</span>
            </div>
            <div class="stat-card card-medium">
                <span class="stat-number text-medium">{{ count_medium }}</span>
                <span class="stat-label">Medium Risk</span>
            </div>
            <div class="stat-card card-low">
                <span class="stat-number text-low">{{ count_low }}</span>
                <span class="stat-label">Low Risk</span>
            </div>
        </div>

        <div class="section-title">DETAILED FINDINGS (NON-PASS ITEMS ONLY)</div>
        
        {% if results|length == 0 %}
        <div style="text-align: center; padding: 40px; background: #e8f6f3; border-radius: 6px; color: #27ae60; margin: 20px 0;">
            <h2 style="margin: 0; font-size: 20px;">üéâ EXCELLENT! ALL CHECKS PASSED.</h2>
            <p style="margin: 10px 0 0 0;">No security issues found according to CIS Benchmark standards.</p>
        </div>
        {% else %}
            {% for item in results %}
            <div class="finding-card">
                <div class="finding-header">
                    <div class="finding-title">{{ item.id }} - {{ item.title }}</div>
                    <div>
                        {% if item.status == 'FAIL' %}
                        <span class="badge badge-fail">FAIL</span>
                        {% elif item.status == 'MANUAL' %}
                        <span class="badge badge-manual">MANUAL</span>
                        {% elif item.status == 'SKIP' %}
                        <span class="badge badge-skip">SKIP</span>
                        {% elif item.status == 'ERROR' %}
                        <span class="badge badge-error">ERROR</span>
                        {% else %}
                        <span class="badge">{{ item.status }}</span>
                        {% endif %}
                        <span class="badge badge-severity">{{ item.severity }}</span>
                    </div>
                </div>
                <div class="finding-body">
                    <div class="sub-label">Description</div>
                    <div class="content-text">{{ item.description }}</div>
                    
                    <div class="sub-label">Status</div>
                    <div class="content-text">
                        {% if item.status == 'FAIL' %}
                        <strong style="color: #c0392b;">FAILED</strong> - Configuration does not meet CIS security requirements.
                        {% elif item.status == 'MANUAL' %}
                        <strong style="color: #f39c12;">MANUAL REVIEW REQUIRED</strong> - This check requires manual verification per CIS Benchmark.
                        {% elif item.status == 'SKIP' %}
                        <strong style="color: #7f8c8d;">SKIPPED</strong> - This check was skipped (dependency not met).
                        {% elif item.status == 'ERROR' %}
                        <strong style="color: #95a5a6;">ERROR</strong> - An error occurred during check execution.
                        {% else %}
                        <strong>{{ item.status }}</strong>
                        {% endif %}
                    </div>
                    
                    {% if item.status != 'PASS' and item.fix %}
                    <div class="sub-label">Remediation</div>
                    <div class="remediation-box">{{ item.fix }}</div>
                    {% endif %}

                    <div class="sub-label">Evidence</div>
                    <div class="evidence-box">{{ item.actual }}</div>
                </div>
            </div>
            {% endfor %}
        {% endif %}

        <div class="footer">
            <p>CONFIDENTIAL - Generated by CIS Apache Audit Tool | Based on CIS Apache HTTP Server 2.4 Benchmark v2.3.0</p>
            <p class="small-text">Reference: CIS Apache HTTP Server 2.4 Benchmark v2.3.0 - 09-23-2025 | Report ID: {{ date | replace(" ", "_") | replace(":", "") }}</p>
        </div>
    </div>
</body>
</html>
